<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Générateur de Carte de Noël Magique</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    
    <!-- html2canvas pour le téléchargement -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              // On utilise des variables CSS ici pour pouvoir changer les couleurs via JS
              primary: "var(--color-primary)", 
              secondary: "var(--color-secondary)", 
              gold: "var(--color-gold)", 
              paper: "#FFF8F0",
              darkbg: "#0F172A",
            },
            fontFamily: {
              display: ['"Mountains of Christmas"', 'cursive'],
              sans: ['"Nunito Sans"', 'sans-serif'],
            },
          },
        },
      };
    </script>
    <style>
        /* DÉFINITION DES COULEURS PAR DÉFAUT (Rouge Noël) */
        :root {
            --color-primary: #D32F2F;
            --color-secondary: #1B5E20;
            --color-gold: #FFC107;
        }

        /* Animation Neige */
        .snowflake { color: #fff; font-size: 1em; font-family: Arial; text-shadow: 0 0 1px #000; position:fixed; top:-10%; z-index:9999; user-select:none; cursor:default; animation-name:snowflakes-fall,snowflakes-shake; animation-duration:10s,3s; animation-timing-function:linear,ease-in-out; animation-iteration-count:infinite,infinite; animation-play-state:running,running }
        @keyframes snowflakes-fall{0%{top:-10%}100%{top:100%}}
        @keyframes snowflakes-shake{0%{transform:translateX(0px)}50%{transform:translateX(80px)}100%{transform:translateX(0px)}}
        .snowflake:nth-of-type(0){left:1%;animation-delay:0s,0s}.snowflake:nth-of-type(1){left:10%;animation-delay:1s,1s}.snowflake:nth-of-type(2){left:20%;animation-delay:6s,.5s}.snowflake:nth-of-type(3){left:30%;animation-delay:4s,2s}.snowflake:nth-of-type(4){left:40%;animation-delay:2s,2s}.snowflake:nth-of-type(5){left:50%;animation-delay:8s,3s}

        /* Style spécifique pour la zone de capture */
        #card-preview {
            aspect-ratio: 4/5;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
        }
        
        /* Style des boutons de couleur */
        .color-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .color-btn:hover { transform: scale(1.1); }
    </style>
</head>
<body class="bg-paper dark:bg-darkbg font-sans transition-colors duration-300 min-h-screen flex flex-col overflow-x-hidden">

    <!-- Neige -->
    <div aria-hidden="true" class="snowflakes pointer-events-none">
        <div class="snowflake">❅</div><div class="snowflake">❄</div><div class="snowflake">❆</div>
        <div class="snowflake">❅</div><div class="snowflake">❄</div><div class="snowflake">❆</div>
    </div>

    <!-- Header -->
    <nav class="w-full px-6 py-4 flex justify-between items-center bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white shadow-lg transition-colors duration-300">
                <span class="material-icons-round">card_giftcard</span>
            </div>
            <span class="text-xl font-bold text-gray-800 dark:text-gray-100 font-display tracking-wide">NoëlMagique</span>
        </div>
        <button class="p-2 rounded-full text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800" onclick="document.documentElement.classList.toggle('dark')">
            <span class="material-icons-round block dark:hidden">dark_mode</span>
            <span class="material-icons-round hidden dark:block">light_mode</span>
        </button>
    </nav>

    <main class="flex-grow flex flex-col lg:flex-row items-start justify-center px-4 py-8 lg:px-20 gap-10 max-w-7xl mx-auto z-10 w-full">
        
        <!-- COLONNE GAUCHE : FORMULAIRE -->
        <div class="w-full lg:w-1/3 space-y-6">
            <div class="text-center lg:text-left space-y-2">
                <h1 class="text-4xl font-display font-bold text-gray-900 dark:text-white">Votre Carte Unique</h1>
                <p class="text-gray-600 dark:text-gray-400">Remplissez les informations ci-dessous pour générer votre carte.</p>
            </div>

            <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-700 space-y-6">
                
                <!-- 1. Upload Photo -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">1. Votre Photo</label>
                    <div class="relative group cursor-pointer" onclick="document.getElementById('fileInput').click()">
                        <div class="border-2 border-dashed border-primary/30 rounded-xl p-6 flex flex-col items-center justify-center hover:bg-primary/5 hover:border-primary transition-colors bg-gray-50 dark:bg-slate-900/50">
                            <span class="material-icons-round text-3xl text-primary mb-2 transition-colors duration-300">add_a_photo</span>
                            <span class="text-sm text-gray-500 text-center" id="fileName">Cliquez pour ajouter une photo</span>
                        </div>
                        <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="handleImageUpload(event)">
                    </div>
                </div>

                <!-- 2. Type de carte (Famille vs Solo) -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">2. Type de carte</label>
                    <div class="grid grid-cols-2 gap-2 p-1 bg-gray-100 dark:bg-slate-900 rounded-lg">
                        <button onclick="setMode('solo')" id="btn-solo" class="px-4 py-2 rounded-md text-sm font-bold bg-white text-primary shadow-sm transition-all">Solo</button>
                        <button onclick="setMode('family')" id="btn-family" class="px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all">Famille</button>
                    </div>
                </div>

                <!-- 3. Message -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">3. Votre Message</label>
                    <textarea id="messageInput" rows="3" class="w-full rounded-xl border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-900 dark:text-white focus:ring-primary focus:border-primary transition-colors duration-300" placeholder="Écrivez votre vœu ici..." oninput="updateMessage()">Je vous souhaite un merveilleux Noël et une bonne année !</textarea>
                </div>

                <!-- 4. Signature -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">4. Signature</label>
                    <input type="text" id="signInput" class="w-full rounded-xl border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-900 dark:text-white focus:ring-primary focus:border-primary transition-colors duration-300" placeholder="Ex: Manu" value="Manu" oninput="updateSignature()">
                </div>

                <!-- 5. NOUS AVONS AJOUTÉ CECI : Choix des Couleurs -->
                <div>
                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">5. Choix des couleurs</label>
                    <div class="flex gap-3 justify-start">
                        <!-- Rouge Classique -->
                        <button onclick="changePalette('classic')" class="color-btn" style="background: linear-gradient(135deg, #D32F2F 50%, #1B5E20 50%);" title="Classique"></button>
                        <!-- Bleu Glacé -->
                        <button onclick="changePalette('ice')" class="color-btn" style="background: linear-gradient(135deg, #0284c7 50%, #0f172a 50%);" title="Hiver Glacé"></button>
                        <!-- Violet Royal -->
                        <button onclick="changePalette('royal')" class="color-btn" style="background: linear-gradient(135deg, #7c3aed 50%, #4c1d95 50%);" title="Royal"></button>
                        <!-- Or & Noir -->
                        <button onclick="changePalette('gold')" class="color-btn" style="background: linear-gradient(135deg, #b45309 50%, #1c1917 50%);" title="Luxe"></button>
                    </div>
                </div>

                <!-- Bouton Download -->
                <button onclick="downloadCard()" class="w-full bg-secondary hover:brightness-110 text-white py-4 rounded-xl font-bold shadow-lg shadow-green-900/20 transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 text-lg">
                    <span class="material-icons-round">download</span>
                    Télécharger ma Carte
                </button>
            </div>
        </div>

        <!-- COLONNE DROITE : APERÇU (LA CARTE) -->
        <div class="w-full lg:w-2/3 flex items-start justify-center pt-4">
            <!-- Conteneur qui sera téléchargé -->
            <div id="card-preview" class="relative bg-white shadow-2xl overflow-hidden w-full max-w-[500px] rounded-sm flex flex-col">
                
                <!-- Design de la carte -->
                <div class="h-full w-full p-8 flex flex-col items-center justify-between border-[12px] border-primary transition-colors duration-300 relative z-10">
                    
                    <!-- Décorations coins -->
                    <div class="absolute top-2 left-2 text-gold opacity-50"><span class="material-icons-round text-4xl">ac_unit</span></div>
                    <div class="absolute top-2 right-2 text-gold opacity-50"><span class="material-icons-round text-4xl">ac_unit</span></div>
                    <div class="absolute bottom-2 left-2 text-gold opacity-50"><span class="material-icons-round text-4xl">ac_unit</span></div>
                    <div class="absolute bottom-2 right-2 text-gold opacity-50"><span class="material-icons-round text-4xl">ac_unit</span></div>

                    <!-- En-tête -->
                    <div class="text-center mt-4 mb-6 z-20">
                        <h2 class="font-display text-5xl text-secondary transition-colors duration-300 mb-1">Joyeux Noël</h2>
                        <div class="w-24 h-1 bg-gold mx-auto rounded-full"></div>
                    </div>

                    <!-- Zone Photo -->
                    <div class="relative w-64 h-64 mb-6 group">
                        <!-- Cadre décoratif -->
                        <div class="absolute inset-0 rounded-full border-4 border-dashed border-gold animate-[spin_20s_linear_infinite]"></div>
                        <!-- Container Image -->
                        <div class="w-full h-full rounded-full border-8 border-white shadow-xl overflow-hidden bg-gray-200 flex items-center justify-center relative z-10">
                            <img id="previewImage" src="https://via.placeholder.com/400x400?text=Votre+Photo" class="w-full h-full object-cover">
                        </div>
                        <!-- Petite icône badge -->
                        <div class="absolute -bottom-2 -right-2 z-20 bg-primary transition-colors duration-300 text-white p-2 rounded-full shadow-md border-2 border-white">
                             <span class="material-icons-round" id="modeIcon">person</span>
                        </div>
                    </div>

                    <!-- Zone Texte -->
                    <div class="text-center space-y-4 mb-8 px-4 z-20">
                        <p id="cardMessage" class="font-sans text-gray-700 text-lg leading-relaxed italic">
                            "Je vous souhaite un merveilleux Noël et une bonne année !"
                        </p>
                        <p class="font-display text-2xl text-primary transition-colors duration-300 mt-4">
                            Avec amour,<br>
                            <span id="cardSignature" class="text-gray-900">Manu</span>
                        </p>
                    </div>

                    <!-- Footer carte -->
                    <div class="w-full text-center py-2 border-t border-gray-100 mt-auto">
                        <span class="text-xs text-gray-400 uppercase tracking-widest">Édition 2025</span>
                    </div>
                </div>

                <!-- Texture fond subtile (utilise Primary pour la teinte) -->
                <div class="absolute inset-0 opacity-10 pointer-events-none transition-colors duration-300" style="background-image: radial-gradient(var(--color-primary) 1px, transparent 1px); background-size: 20px 20px;"></div>
            </div>
        </div>
    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Variables
        const fileInput = document.getElementById('fileInput');
        const previewImage = document.getElementById('previewImage');
        const fileNameDisplay = document.getElementById('fileName');
        const modeIcon = document.getElementById('modeIcon');
        
        let currentMode = 'solo';

        // --- NOUVEAU : Logique de changement de couleurs ---
        const palettes = {
            classic: { primary: '#D32F2F', secondary: '#1B5E20', gold: '#FFC107' }, // Rouge / Vert / Or
            ice:     { primary: '#0284c7', secondary: '#0f172a', gold: '#7dd3fc' }, // Bleu ciel / Bleu nuit / Bleu clair
            royal:   { primary: '#7c3aed', secondary: '#4c1d95', gold: '#fcd34d' }, // Violet / Violet foncé / Or
            gold:    { primary: '#b45309', secondary: '#1c1917', gold: '#fbbf24' }  // Bronze / Noir / Ambre
        };

        function changePalette(paletteName) {
            const p = palettes[paletteName];
            // On change les variables CSS à la racine du document
            document.documentElement.style.setProperty('--color-primary', p.primary);
            document.documentElement.style.setProperty('--color-secondary', p.secondary);
            document.documentElement.style.setProperty('--color-gold', p.gold);
        }
        // ----------------------------------------------------

        // 1. Gestion de l'upload d'image
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                }
                reader.readAsDataURL(file);
                fileNameDisplay.textContent = file.name;
            }
        }

        // 2. Mise à jour du texte
        function updateMessage() {
            const inputVal = document.getElementById('messageInput').value;
            // Si le champ est vide, on met un texte par défaut
            document.getElementById('cardMessage').textContent = inputVal ? `"${inputVal}"` : "...";
        }

        function updateSignature() {
            const inputVal = document.getElementById('signInput').value;
            document.getElementById('cardSignature').textContent = inputVal;
        }

        // 3. Gestion Famille / Solo
        function setMode(mode) {
            currentMode = mode;
            const btnSolo = document.getElementById('btn-solo');
            const btnFamily = document.getElementById('btn-family');
            const msgInput = document.getElementById('messageInput');
            const signInput = document.getElementById('signInput');

            // Style des boutons
            if (mode === 'solo') {
                btnSolo.className = "px-4 py-2 rounded-md text-sm font-bold bg-white text-primary shadow-sm transition-all";
                btnFamily.className = "px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all";
                modeIcon.textContent = "person";
                
                // Textes par défaut si l'utilisateur n'a pas tout changé
                if(msgInput.value.includes("Nous")) {
                    msgInput.value = "Je vous souhaite un merveilleux Noël et une bonne année !";
                    signInput.value = "Manu"; // Reset générique
                }
            } else {
                btnFamily.className = "px-4 py-2 rounded-md text-sm font-bold bg-white text-primary shadow-sm transition-all";
                btnSolo.className = "px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition-all";
                modeIcon.textContent = "groups";

                if(msgInput.value.includes("Je")) {
                    msgInput.value = "Nous vous souhaitons de joyeuses fêtes remplies de bonheur !";
                    signInput.value = "La Famille Martin"; // Reset générique
                }
            }
            updateMessage();
            updateSignature();
        }

        // 4. Fonction de téléchargement
        function downloadCard() {
            const cardElement = document.getElementById('card-preview');
            
            // On fait défiler jusqu'en haut pour éviter les bugs de capture
            window.scrollTo(0,0);

            html2canvas(cardElement, {
                scale: 2, // Meilleure qualité (HD)
                useCORS: true, // Pour essayer de gérer les images externes si besoin
                backgroundColor: null,
            }).then(canvas => {
                // Créer le lien de téléchargement
                const link = document.createElement('a');
                link.download = 'ma-carte-de-noel.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(err => {
                console.error("Erreur lors de la génération :", err);
                alert("Oups ! Une erreur est survenue lors de la création de l'image.");
            });
        }
    </script>
</body>
</html>